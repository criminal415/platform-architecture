# ADR: 0001 하이퍼바이저 선택

## Context
본 프로젝트는 개인 프로젝트 환경에서 **쿠버네티스 클러스터**를 구축하고,  
개인 도메인을 통한 실제 서비스 배포를 통해 **상용 수준의 서버 설정 및 운영 경험**을 얻는 것을 목표로 한다.  

이를 위해, 서버급 워크스테이션에 하이퍼바이저를 설치하고 VM 기반으로 K8s 마스터/워커 노드를 구성한다.  
가상화 기술적 배경은 다음과 같다:

- **Type 1 하이퍼바이저 (Bare-metal)**:  
  하드웨어에 직접 설치되어 높은 성능과 안정성을 제공한다.  
- **전가상화(Full Virtualization)**: 게스트 OS 수정 불필요하지만 오버헤드 존재.  
- **반가상화(Paravirtualization)**: 성능은 향상되나 게스트 OS 수정 필요.  
- **하드웨어 보조 가상화(Hardware-assisted Virtualization, Intel VT-x / AMD-V)**: CPU 확장 기능을 활용해 전가상화의 범용성과 반가상화의 성능을 동시에 확보.  

본 프로젝트는 **상용 환경에 근접한 운영 경험**을 목표로 하므로,  
**Type 1 하이퍼바이저 + 하드웨어 보조 가상화** 조합을 선택한다.  

## Alternatives Considered
- **XCP-ng**  
  - Xen 기반 Type 1 하이퍼바이저, Citrix XenServer의 오픈소스 계승  
  - 엔터프라이즈급 기능(HA, 라이브 마이그레이션, 풀 관리) 제공  
  - 관리 도구:
    - **과거**: Windows 전용 클라이언트인 **XenCenter**를 통해 서버 IP에 직접 접속 → VM 생성 및 관리  
    - **현재**: 웹 기반 **Xen Orchestra(XO)**를 별도 서비스로 띄워 관리 → 브라우저 기반 접근 가능, 최신 기능 지원  

- **Proxmox VE**  
  - KVM + LXC 기반 Type 1 하이퍼바이저  
  - 설치 즉시 웹 UI 제공, VM 및 컨테이너 혼합 운영 가능  
  - 커뮤니티 문서 풍부, 개인/소규모 운영에 최적화  

- **KVM (libvirt / oVirt / Cockpit)**  
  - 리눅스 커널 내장 하이퍼바이저, 성능 및 안정성 우수  
  - 관리 스택(oVirt, virt-manager, cockpit 등)이 다양하여 유연성은 높지만 복잡도 증가  
  - 초기 세팅과 학습 곡선이 상대적으로 가파름  

## Decision
- **XCP-ng**를 선택한다.  
- 근거:
  - 과거 **XenCenter 무료 버전 경험**을 통해 Xen 생태계에 친숙함  
  - 현재는 **Xen Orchestra**라는 웹 기반 관리 툴을 통해 최신 기능과 엔터프라이즈급 운영 패턴을 학습할 수 있음  
  - 관리 스택 분리(XCP-ng + XO) 구조는 **엔터프라이즈 운영 모델에 가까움**  
  - 오픈소스 기반으로 비용 부담 없이 엔터프라이즈 기능 체험 가능  

## Status
- **Accepted**  
- 서버급 워크스테이션에 **XCP-ng**를 설치하고, **Xen Orchestra**를 별도 VM 또는 어플라이언스로 배포해 관리 환경을 구성한다.  
- VM 기반 쿠버네티스 클러스터를 구성하고, 실제 도메인 서비스를 운영한다.  

## Consequences
- **Positive**
  - Type 1 + 하드웨어 보조 가상화 기반으로 성능과 안정성 확보  
  - 관리 스택(Xen Orchestra) 분리를 통한 상용 수준 운영 경험 체득  
  - 과거 XenCenter 경험을 확장하여 웹 기반 관리로 발전된 워크플로우 학습 가능  
  - 오픈소스 기반으로 비용 부담 없이 엔터프라이즈 기능 체험 가능  

- **Negative**
  - Proxmox 대비 초기 세팅이 복잡 (별도 XO 설치 필요)  
  - 관리 VM(XO)을 위한 추가 리소스 필요  